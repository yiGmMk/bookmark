# 使用 CoreDNS 搭建本地域名服务
- URL: https://george.betterde.com/devops/20221120.html
- Added At: 2024-12-11 06:53:30
- [Link To Text](2024-12-11-使用-coredns-搭建本地域名服务_raw.md)

## TL;DR
本文介绍了使用 CoreDNS 搭建本地域名服务的方法，解决了开发环境中域名配置不一致的问题。通过自行构建 ARM 架构的 Docker Image 和配置 CoreDNS，实现了域名解析和日志设置。同时，介绍了如何在 macOS 上配置 DNS 服务器和验证 DNS 配置。

## Summary
1. **前言**：本文介绍了使用 CoreDNS 搭建本地域名服务的方法，解决了开发环境中域名配置不一致的问题。

2. **问题描述**：在使用 Docker 搭建的开发环境中，每个人需要在本地 `/etc/hosts` 文件中配置项目域名，导致域名配置不一致，影响团队协作。

3. **选型**：
   - **dnsmasq**：优先考虑，但没有找到官方维护的 Docker Image。
   - **CoreDNS**：基于 Go 语言开发，Cloud Native 孵化的毕业项目，社区活跃，支持通配符解析。
   - **AdGuardDNS**：面向普通用户，不太适合开发者，主要用于拦截广告。

4. **获取镜像**：由于官方没有提供 ARM 架构的 Docker Image，需要自行构建 ARM 架构的 Docker Image。

5. **配置**：
   - **docker-compose.yml**：配置容器编排，包括 CoreDNS 服务和端口映射。
   - **Corefile**：配置 CoreDNS，包括域名解析和日志设置。
   - **betterde.it.db**：配置域名解析数据，包括 SOA 记录和 A 记录。

6. **启动服务**：使用 `docker compose up -d` 命令启动 CoreDNS 服务。

7. **验证结果**：使用 `dig` 命令验证域名解析结果。

8. **使用 CoreDNS**：
   - **配置 DNS**：在 macOS 上配置 DNS 服务器，使用 `networksetup` 命令设置 DNS 服务器为 127.0.0.1。
   - **验证结果**：使用 `scutil --dns` 命令验证 DNS 配置。

9. **总结**：本文介绍了使用 CoreDNS 搭建本地域名服务的方法，解决了开发环境中域名配置不一致的问题。
