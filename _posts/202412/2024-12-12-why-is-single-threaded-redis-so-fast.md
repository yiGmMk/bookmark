---
layout: post
---
# Why is single threaded Redis so fast
- URL: [原文](https://www.pixelstech.net/article/1677580861-Why-is-single-threaded-Redis-so-fast)
- Added At: 2024-12-12 01:50:29
- [Link To Text](_posts/2024-12-12-why-is-single-threaded-redis-so-fast_raw.md)

## TL;DR
Redis是一款高性能内存键值数据库，采用单线程架构，支持高达100,000 QPS的单机性能。其单线程设计易于实现，且CPU不会成为瓶颈。Redis完全基于内存存储，数据存储在内存中，大多数请求都是纯内存操作，速度极快。Redis有5种数据类型，分别是String、List、Hash、Set和SortedSet，每种数据类型使用一种或多种底层数据结构来支持，旨在实现更快的速度。

## Summary
1. **Redis简介**：Redis是一款高性能的内存键值数据库，支持高达100,000 QPS（每秒查询数）的单机性能，采用单线程架构。

2. **单线程设计**：Redis采用单线程设计，主要原因是CPU不是Redis的瓶颈，更多的是机器内存或网络带宽。单线程设计易于实现，且CPU不会成为瓶颈。

3. **内存存储**：Redis完全基于内存存储，数据存储在内存中，大多数请求都是纯内存操作，速度极快，避免了从磁盘读取数据的开销。

4. **数据类型和结构**：Redis有5种数据类型，分别是String、List、Hash、Set和SortedSet，每种数据类型使用一种或多种底层数据结构来支持，旨在实现更快的速度。

5. **单线程优势**：使用单线程可以节省大量时间用于上下文切换和CPU消耗，没有竞争条件，不需要考虑各种锁定问题，也没有可能导致性能开销的死锁问题。此外，还可以使用各种“线程不安全”的命令，如`Lpush`。

6. **非阻塞I/O**：使用基于网络I/O多路复用的线程模型（非阻塞I/O）可以处理并发连接，帮助缓解慢速网络I/O速度的问题。

7. **Reactor模式**：Redis的网络事件处理器基于Reactor模式，也称为文件事件处理器。文件事件处理器使用I/O多路复用同时监听多个套接字，并将套接字执行的任务与不同的事件处理器关联。

8. **Redis 6.0多线程**：
   - **为什么Redis 6.0之前没有使用多线程？**：Redis使用单线程方法实现高可维护性，多线程虽然在某些方面表现良好，但引入了程序执行顺序的不确定性，导致一系列并发读写问题，增加了系统复杂性，可能导致线程切换、锁定和解锁以及死锁等问题导致的性能损失。
   - **为什么Redis 6.0引入多线程？**：Redis 6.0引入多线程是因为其瓶颈不在内存，而在网络I/O模块，占用CPU时间。因此，引入多线程来处理网络I/O，充分利用CPU资源，减少网络I/O阻塞导致的性能损失。
   - **如何在Redis 6.0中启用多线程？**：默认情况下，Redis禁用多线程，可以在配置文件中启用：`io-threads-do-reads yes`和`io-threads [线程数]`。官方建议为4核机器设置2-3个线程，为8核机器设置6个线程。线程数应少于机器核心数，尽量不超过8个线程。
   - **多线程模式下是否存在线程并发问题？**：Redis的多线程部分仅用于处理网络数据读写和协议解析，命令执行仍然在单线程中顺序执行，因此没有并发安全问题。
