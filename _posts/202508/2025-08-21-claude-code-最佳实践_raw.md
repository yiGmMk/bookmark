---
layout: post
---
Title: Claude Code 最佳实践

URL Source: https://ai.programnotes.cn/p/claude-code-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/

Published Time: 2025-08-21T00:00:00+00:00

Markdown Content:
[人工智能](https://ai.programnotes.cn/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/)[开发](https://ai.programnotes.cn/categories/%E5%BC%80%E5%8F%91/)
### Anthropic官方发布的Claude Code使用最佳实践，帮助开发者更高效地利用AI进行编程。本文为完整翻译版。

Claude Code：代理式编码的最佳实践
----------------------

Claude Code 是一款用于代理式编码（agentic coding）的命令行工具。本文将介绍一些在使用 Claude Code 过程中，跨越不同代码库、语言和环境时被证明行之有效的技巧和窍门。

我们最近发布了 Claude Code，这是一款用于代理式编码的命令行工具。作为一项研究项目，Claude Code 为 Anthropic 的工程师和研究人员提供了一种更原生的方式，将 Claude 集成到他们的编码工作流中。

Claude Code 故意设计得底层且不固执己见，提供近乎原始的模型访问权限，而不强加特定的工作流。这种设计理念创造了一个灵活、可定制、可编写脚本且功能强大的安全工具。虽然功能强大，但这种灵活性也给刚接触代理式编码工具的工程师带来了一定的学习曲线——至少在他们形成自己的最佳实践之前是这样。

本文概述了一些通用的模式，这些模式在 Anthropic 的内部团队和外部工程师在各种代码库、语言和环境中使用 Claude Code 时都被证明是有效的。此列表中的任何内容都不是一成不变的，也不是普遍适用的；请将这些建议视为起点。我们鼓励您进行实验，找到最适合您的方法！

想了解更详细的信息吗？我们在 claude.ai/code 上的综合文档涵盖了本文提到的所有功能，并提供了额外的示例、实现细节和高级技术。

### 1. 自定义您的设置

Claude Code 是一个代理式编码助手，它会自动将上下文提取到提示中。这种上下文收集会消耗时间和 token，但您可以通过环境调整来优化它。

#### a. 创建 `CLAUDE.md` 文件

`CLAUDE.md` 是一个特殊文件，Claude 在开始对话时会自动将其提取到上下文中。这使其成为记录以下内容的理想场所：

*   常用的 bash 命令
*   核心文件和实用函数
*   代码风格指南
*   测试说明
*   代码仓库礼仪（例如，分支命名、merge vs. rebase 等）
*   开发环境设置（例如，pyenv 的使用、哪些编译器可用）
*   项目特有的任何意外行为或警告
*   您希望 Claude 记住的其他信息

`CLAUDE.md` 文件没有固定的格式。我们建议保持其简洁易读。例如：

```
1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
``````
# Bash 命令
- npm run build: 构建项目
- npm run typecheck: 运行类型检查器

# 代码风格
- 使用 ES 模块 (import/export) 语法，而不是 CommonJS (require)
- 尽可能解构导入 (例如 import { foo } from 'bar')

# 工作流
- 在完成一系列代码更改后，请务必进行类型检查
- 为提高性能，优先运行单个测试，而不是整个测试套件
```

您可以将 `CLAUDE.md` 文件放置在多个位置：

*   **仓库的根目录**，或您运行 `claude` 的任何位置（最常见的用法）。将其命名为 `CLAUDE.md` 并检入 git，以便您可以在不同会话和团队之间共享（推荐），或者将其命名为 `CLAUDE.local.md` 并将其添加到 `.gitignore` 中。
*   **运行 `claude` 的目录的任何父目录**。这在 monorepo 中最有用，您可能从 `root/foo` 运行 `claude`，并在 `root/CLAUDE.md` 和 `root/foo/CLAUDE.md` 中都有 `CLAUDE.md` 文件。这两个文件都会被自动提取到上下文中。
*   **运行 `claude` 的目录的任何子目录**。这与上述情况相反，在这种情况下，当您处理子目录中的文件时，Claude 会按需提取 `CLAUDE.md` 文件。
*   **您的主文件夹** (`~/.claude/CLAUDE.md`)，它会应用于您所有的 `claude` 会话。

当您运行 `/init` 命令时，Claude 会自动为您生成一个 `CLAUDE.md` 文件。

#### b. 调整您的 `CLAUDE.md` 文件

您的 `CLAUDE.md` 文件会成为 Claude 提示的一部分，因此应像任何常用提示一样对其进行优化。一个常见的错误是添加大量内容而没有迭代其有效性。花时间进行实验，确定什么能从模型中产生最佳的指令遵循效果。

您可以手动向 `CLAUDE.md` 添加内容，或按 `#` 键向 Claude 发出指令，它会自动将其合并到相关的 `CLAUDE.md` 中。许多工程师在编码时经常使用 `#` 来记录命令、文件和风格指南，然后将 `CLAUDE.md` 的更改包含在提交中，以便团队成员也能受益。

在 Anthropic，我们偶尔会通过提示改进器来运行 `CLAUDE.md` 文件，并经常调整指令（例如，用 “IMPORTANT” 或 “YOU MUST” 来强调）以提高遵循度。

#### c. 管理 Claude 允许的工具列表

默认情况下，Claude Code 对任何可能修改您系统的操作都会请求权限：文件写入、许多 bash 命令、MCP 工具等。我们采用这种刻意保守的方法设计 Claude Code，以优先考虑安全性。您可以自定义允许列表，以允许您知道是安全的其他工具，或者允许易于撤销的潜在不安全工具（例如，文件编辑、`git commit`）。

有四种方法可以管理允许的工具：

1.   在会话期间出现提示时选择“始终允许”。
2.   启动 Claude Code 后使用 `/permissions` 命令添加或删除工具。例如，您可以添加 `Edit` 以始终允许文件编辑，`Bash(git commit:*)` 以允许 git 提交，或 `mcp__puppeteer__puppeteer_navigate` 以允许使用 Puppeteer MCP 服务器进行导航。
3.   手动编辑您的 `.claude/settings.json` 或 `~/.claude.json`（我们建议将前者检入源代码控制以与您的团队共享）。
4.   使用 `--allowedTools` CLI 标志进行会话特定的权限设置。

#### d. 如果使用 GitHub，请安装 `gh` CLI

Claude 知道如何使用 `gh` CLI 与 GitHub 交互，以创建 issue、打开 pull request、阅读评论等。如果没有安装 `gh`，Claude 仍然可以使用 GitHub API 或 MCP 服务器（如果您已安装）。

### 2. 为 Claude 提供更多工具

Claude 可以访问您的 shell 环境，您可以在其中为它构建便利的脚本和函数集，就像为自己构建一样。它还可以通过 MCP 和 REST API 利用更复杂的工具。

#### a. 将 Claude 与 bash 工具结合使用

Claude Code 继承了您的 bash 环境，使其可以访问您的所有工具。虽然 Claude 了解像 unix 工具和 `gh` 这样的常用实用程序，但如果没有说明，它不会知道您的自定义 bash 工具：

*   告诉 Claude 工具名称和使用示例。
*   告诉 Claude 运行 `--help` 查看工具文档。
*   在 `CLAUDE.md` 中记录常用工具。

#### b. 将 Claude 与 MCP 结合使用

Claude Code 同时充当 MCP 服务器和客户端。作为客户端，它可以通过三种方式连接到任意数量的 MCP 服务器以访问其工具：

1.   在项目配置中（在项目目录中运行 Claude Code 时可用）。
2.   在全局配置中（在所有项目中可用）。
3.   在检入的 `.mcp.json` 文件中（对在您的代码库中工作的任何人可用）。例如，您可以将 Puppeteer 和 Sentry 服务器添加到您的 `.mcp.json` 中，这样在您的仓库中工作的每位工程师都可以开箱即用地使用这些工具。

在使用 MCP 时，使用 `--mcp-debug` 标志启动 Claude 也有助于识别配置问题。

#### c. 使用自定义斜杠命令

对于重复的工作流——调试循环、日志分析等——将提示模板存储在 `.claude/commands` 文件夹中的 Markdown 文件中。当您键入 `/` 时，这些模板将通过斜杠命令菜单可用。您可以将这些命令检入 git，使其对团队其他成员可用。

自定义斜杠命令可以包含特殊关键字 `$ARGUMENTS` 以从命令调用中传递参数。

例如，这是一个可用于自动拉取和修复 Github issue 的斜杠命令：

```
1
 2
 3
 4
 5
 6
 7
 8
 9
10
``````
请分析并修复 GitHub issue：$ARGUMENTS。请遵循以下步骤：
1. 使用 `gh issue view` 获取 issue 详细信息。
2. 理解 issue 中描述的问题。
3. 在代码库中搜索相关文件。
4. 实施必要的更改以修复问题。
5. 编写并运行测试以验证修复。
6. 确保代码通过 linting 和类型检查。
7. 创建一个描述性的提交消息。
8. 推送并创建一个 PR。
请记住使用 GitHub CLI (`gh`) 来完成所有与 GitHub 相关的任务。
```

将上述内容放入 `.claude/commands/fix-github-issue.md` 中，使其在 Claude Code 中作为 `/project:fix-github-issue` 命令可用。然后，您可以使用例如 `/project:fix-github-issue 1234` 来让 Claude 修复 issue #1234。同样，您可以将自己的个人命令添加到 `~/.claude/commands` 文件夹中，以便在所有会话中使用。

### 3. 尝试常见的工作流

Claude Code 不会强加特定的工作流，让您可以灵活地按自己的方式使用它。在这种灵活性提供的空间内，我们的用户社区中出现了几种有效使用 Claude Code 的成功模式：

#### a. 探索、计划、编码、提交

这个通用的工作流适用于许多问题：

1.   **要求 Claude 阅读相关文件、图像或 URL**，可以提供一般性指引（“阅读处理日志记录的文件”）或特定文件名（“阅读 logging.py”），但要明确告诉它暂时不要编写任何代码。 
    *   在这个工作流的这个部分，您应该考虑强力使用子代理，特别是对于复杂问题。告诉 Claude 使用子代理来验证细节或调查它可能有的特定问题，尤其是在对话或任务的早期，往往可以在不损失太多效率的情况下保留上下文的可用性。

2.   **要求 Claude 制定解决特定问题的方法计划**。我们建议使用“思考（think）”这个词来触发扩展思考模式，这会给 Claude 额外的计算时间来更彻底地评估替代方案。这些特定的短语直接映射到系统中不断增加的思考预算级别：“think” < “think hard” < “think harder” < “ultrathink”。每个级别都会分配逐渐增多的思考预算供 Claude 使用。 
    *   如果此步骤的结果看起来合理，您可以让 Claude 创建一个文档或一个 GitHub issue，其中包含其计划，这样如果实现（步骤3）不符合您的要求，您可以重置到这个位置。

3.   **要求 Claude 用代码实现其解决方案**。这也是一个好时机，要求它在实现解决方案的各个部分时明确验证其解决方案的合理性。
4.   **要求 Claude 提交结果并创建一个 pull request**。如果相关，这也是让 Claude 更新任何 README 或 changelog，并解释它刚刚做了什么的好时机。

步骤 #1-#2至关重要——没有它们，Claude 往往会直接跳到编码解决方案。虽然有时这正是您想要的，但要求 Claude 先进行研究和规划，可以显著提高解决需要预先深入思考的问题的性能。

#### b. 编写测试，提交；编码，迭代，提交

这是一个在 Anthropic 内部备受青睐的工作流，适用于可以通过单元、集成或端到端测试轻松验证的更改。测试驱动开发（TDD）在代理式编码中变得更加强大：

1.   **要求 Claude 根据预期的输入/输出对编写测试**。明确说明您正在进行测试驱动开发，这样它就会避免创建模拟实现，即使对于代码库中尚不存在的功能也是如此。
2.   **告诉 Claude 运行测试并确认它们失败**。明确告诉它在此阶段不要编写任何实现代码通常很有帮助。
3.   **当您对测试满意时，要求 Claude 提交测试**。
4.   **要求 Claude 编写通过测试的代码**，并指示它不要修改测试。
5.   **告诉 Claude 继续，直到所有测试都通过**。Claude 通常需要几次迭代才能编写代码、运行测试、调整代码并再次运行测试。 
    *   在此阶段，要求它使用独立的子代理来验证实现没有过度拟合测试可能会有所帮助。

6.   **一旦您对更改感到满意，就要求 Claude 提交代码**。

当 Claude 有一个明确的目标可以迭代时，它的表现最好——无论是视觉模型、测试用例还是其他类型的输出。通过提供像测试这样的预期输出，Claude 可以进行更改、评估结果并逐步改进，直到成功。

#### c. 编写代码，截图结果，迭代

与测试工作流类似，您可以为 Claude 提供视觉目标：

1.   **为 Claude 提供一种截取浏览器屏幕截图的方法**（例如，使用 Puppeteer MCP 服务器、iOS 模拟器 MCP 服务器，或手动将屏幕截图复制/粘贴到 Claude 中）。
2.   **通过复制/粘贴或拖放图像，或提供图像文件路径，为 Claude 提供一个视觉模型**。
3.   **要求 Claude 用代码实现设计，截取结果的屏幕截图，并进行迭代，直到其结果与模型匹配**。
4.   **当您满意时，要求 Claude 提交**。

像人类一样，Claude 的输出通常会随着迭代而显著改善。虽然第一个版本可能不错，但经过2-3次迭代后，它通常会看起来好得多。为 Claude 提供查看其输出的工具以获得最佳结果。

#### d. 安全的“YOLO”模式

您可以不监督 Claude，而是使用 `claude --dangerously-skip-permissions` 来绕过所有权限检查，让 Claude 不间断地工作直到完成。这对于修复 lint 错误或生成样板代码等工作流非常有效。

**警告**：让 Claude 运行任意命令是有风险的，可能导致数据丢失、系统损坏甚至数据泄露（例如，通过提示注入攻击）。为了将这些风险降到最低，请在没有互联网访问的容器中使用 `--dangerously-skip-permissions`。您可以参考这个使用 Docker 开发容器的实现。

#### e. 代码库问答

在熟悉新的代码库时，使用 Claude Code 进行学习和探索。您可以向 Claude 提出与结对编程时向项目中的其他工程师提出的同类问题。Claude 可以代理式地搜索代码库以回答一般性问题，例如：

*   日志记录是如何工作的？
*   我如何创建一个新的 API 端点？
*   `foo.rs` 第134行的 `async move { ... }` 是做什么的？
*   `CustomerOnboardingFlowImpl` 处理了哪些边缘情况？
*   为什么我们在第333行调用 `foo()` 而不是 `bar()`？
*   `baz.py` 第334行在 Java 中的等价物是什么？

在 Anthropic，以这种方式使用 Claude Code 已成为我们的核心入职工作流，显著缩短了上手时间并减轻了其他工程师的负担。无需特殊提示！只需提问，Claude 就会探索代码以找到答案。

#### f. 使用 Claude 与 git 交互

Claude 可以有效地处理许多 git 操作。许多 Anthropic 工程师使用 Claude 进行 90% 以上的 git 交互：

*   **搜索 git 历史记录**以回答诸如“v1.2.3 版本中包含了哪些更改？”、“谁拥有这个特定功能？”或“为什么这个 API 是这样设计的？”之类的问题。明确提示 Claude 查看 git 历史记录以回答此类查询很有帮助。
*   **编写提交消息**。Claude 会自动查看您的更改和最近的历史记录，以撰写包含所有相关上下文的消息。
*   **处理复杂的 git 操作**，如还原文件、解决 rebase 冲突以及比较和嫁接补丁。

#### g. 使用 Claude 与 GitHub 交互

Claude Code 可以管理许多 GitHub 交互：

*   **创建 pull request**：Claude 理解速记“pr”，并将根据差异和周围的上下文生成适当的提交消息。
*   **对简单的代码审查评论实施一次性解决方案**：只需告诉它修复您 PR 上的评论（可选地，给它更具体的说明），并在完成后推送回 PR 分支。
*   **修复失败的构建或 linter 警告**。
*   **通过要求 Claude 遍历开放的 GitHub issue 来分类和分流**。

这消除了记住 `gh` 命令行语法的需要，同时自动化了常规任务。

#### h. 使用 Claude 处理 Jupyter notebook

Anthropic 的研究人员和数据科学家使用 Claude Code 来读写 Jupyter notebook。Claude 可以解释包括图像在内的输出，为探索和与数据交互提供了一种快速的方法。没有必需的提示或工作流，但我们推荐的一个工作流是在 VS Code 中并排打开 Claude Code 和一个 `.ipynb` 文件。

您还可以要求 Claude 在向同事展示之前清理或美化您的 Jupyter notebook。明确告诉它使 notebook 或其数据可视化“美观”往往有助于提醒它正在为人类的观看体验进行优化。

### 4. 优化您的工作流

以下建议适用于所有工作流：

#### a. 在您的指令中要具体

Claude Code 的成功率随着更具体的指令而显著提高，尤其是在初次尝试时。预先给出明确的指示可以减少以后进行路线修正的需要。

例如：

| 差的指令 | 好的指令 |
| --- | --- |
| 为 foo.py 添加测试 | 为 foo.py 编写一个新的测试用例，涵盖用户未登录的边缘情况。避免使用 mock。 |
| 为什么 ExecutionFactory 的 api 这么奇怪？ | 查看 ExecutionFactory 的 git 历史记录，并总结其 api 是如何形成的。 |
| 添加一个日历小部件 | 查看主页上现有小部件的实现方式，以了解模式，特别是代码和接口是如何分离的。HotDogWidget.php 是一个很好的起点。然后，遵循该模式实现一个新的日历小部件，让用户可以选择月份并向前/向后翻页以选择年份。除了代码库中已使用的库之外，不要使用其他库从头构建。 |

Claude 可以推断意图，但它无法读懂您的心思。具体性可以更好地与期望保持一致。

#### b. 给 Claude 图像

Claude 通过多种方法在处理图像和图表方面表现出色：

*   粘贴屏幕截图（专业提示：在 macOS 中按 `cmd+ctrl+shift+4` 将屏幕截图到剪贴板，然后按 `ctrl+v` 粘贴。请注意，这与您通常在 Mac 上用于粘贴的 `cmd+v` 不同，并且在远程操作时无效。）
*   将图像直接拖放到提示输入中。
*   提供图像的文件路径。

这在处理用于 UI 开发的设计模型以及用于分析和调试的可视化图表时特别有用。如果您没有向上下文中添加视觉效果，向 Claude 明确说明结果在视觉上具有吸引力的重要性仍然很有帮助。

#### c. 提及您希望 Claude 查看或处理的文件

使用 Tab 键补全可以快速引用仓库中任何位置的文件或文件夹，帮助 Claude 找到或更新正确的资源。

#### d. 给 Claude URL

将特定的 URL 与您的提示一起粘贴，供 Claude 获取和阅读。为避免对相同域（例如，docs.foo.com）的权限提示，请使用 `/permissions` 将域添加到您的允许列表中。

#### e. 及早并经常纠正路线

虽然自动接受模式（按 `shift+tab` 切换）让 Claude 可以自主工作，但通过作为积极的协作者并指导 Claude 的方法，您通常会获得更好的结果。您可以在开始时向 Claude 彻底解释任务以获得最佳结果，但您也可以随时纠正 Claude 的路线。

这四个工具有助于路线修正：

1.   **在编码前要求 Claude 制定计划**。明确告诉它在您确认其计划看起来不错之前不要编码。
2.   **在任何阶段（思考、工具调用、文件编辑）按 Escape 键中断 Claude**，保留上下文，以便您可以重定向或扩展指令。
3.   **双击 Escape 键跳回历史记录**，编辑先前的提示，并探索不同的方向。您可以编辑提示并重复，直到获得所需的结果。
4.   **要求 Claude 撤销更改**，通常与选项 #2 结合使用以采取不同的方法。

尽管 Claude Code 偶尔会在第一次尝试时完美解决问题，但使用这些修正工具通常可以更快地产生更好的解决方案。

#### f. 使用 `/clear` 保持上下文专注

在长时间的会话中，Claude 的上下文窗口可能会充满不相关的对话、文件内容和命令。这会降低性能，有时还会分散 Claude 的注意力。在任务之间频繁使用 `/clear` 命令来重置上下文窗口。

#### g. 对复杂工作流使用清单和草稿板

对于具有多个步骤或需要详尽解决方案的大型任务——如代码迁移、修复大量 lint 错误或运行复杂的构建脚本——通过让 Claude 使用 Markdown 文件（甚至 GitHub issue！）作为清单和工作草稿板来提高性能：

例如，要修复大量的 lint 问题，您可以执行以下操作：

1.   告诉 Claude 运行 lint 命令，并将所有结果错误（包括文件名和行号）写入 Markdown 清单。
2.   指示 Claude 逐个解决每个问题，在勾选并移至下一个问题之前进行修复和验证。

#### h. 将数据传递给 Claude

有几种方法可以向 Claude 提供数据：

*   直接复制并粘贴到您的提示中（最常见的方法）。
*   通过管道传递给 Claude Code（例如，`cat foo.txt | claude`），对于日志、CSV 和大数据特别有用。
*   告诉 Claude 通过 bash 命令、MCP 工具或自定义斜杠命令拉取数据。
*   要求 Claude 读取文件或获取 URL（也适用于图像）。

大多数会话都涉及这些方法的组合。例如，您可以传入一个日志文件，然后告诉 Claude 使用一个工具来引入额外的上下文来调试日志。

### 5. 使用无头模式自动化您的基础架构

Claude Code 包含无头模式，适用于非交互式环境，如 CI、预提交钩子、构建脚本和自动化。使用 `-p` 标志和提示来启用无头模式，并使用 `--output-format stream-json` 进行流式 JSON 输出。

请注意，无头模式在会话之间不持久。您必须在每个会话中触发它。

#### a. 使用 Claude 进行 issue 分流

无头模式可以为由 GitHub 事件触发的自动化提供支持，例如当您的仓库中创建新 issue 时。例如，公共的 Claude Code 仓库使用 Claude 来检查新进的 issue 并分配适当的标签。

#### b. 使用 Claude 作为 linter

Claude Code 可以提供传统 linting 工具无法检测到的主观代码审查，识别诸如拼写错误、过时的注释、误导性的函数或变量名等问题。

### 6. 通过多 Claude 工作流提升水平

除了独立使用之外，一些最强大的应用涉及并行运行多个 Claude 实例：

#### a. 让一个 Claude 编写代码；使用另一个 Claude 进行验证

一个简单但有效的方法是让一个 Claude 编写代码，而另一个则进行审查或测试。与多位工程师合作类似，有时拥有独立的上下文是有益的：

1.   使用 Claude 编写代码。
2.   运行 `/clear` 或在另一个终端中启动第二个 Claude。
3.   让第二个 Claude 审查第一个 Claude 的工作。
4.   启动另一个 Claude（或再次 `/clear`）来阅读代码和审查反馈。
5.   让这个 Claude 根据反馈编辑代码。

您可以用测试做类似的事情：让一个 Claude 编写测试，然后让另一个 Claude 编写代码以使测试通过。您甚至可以让您的 Claude 实例通过给它们独立的草稿板并告诉它们哪个写入哪个读取来相互通信。

这种分离通常比让单个 Claude 处理所有事情产生更好的结果。

#### b. 拥有多个代码库的检出副本

许多 Anthropic 的工程师不是等待 Claude 完成每一步，而是这样做：

1.   在不同的文件夹中创建 3-4 个 git 检出副本。
2.   在不同的终端选项卡中打开每个文件夹。
3.   在每个文件夹中以不同的任务启动 Claude。
4.   循环检查进度并批准/拒绝权限请求。

#### c. 使用 git worktrees

这种方法在处理多个独立任务时表现出色，为多个检出副本提供了一种更轻量级的替代方案。Git worktrees 允许您将同一仓库的多个分支检出到不同的目录中。每个 worktree 都有自己的工作目录和隔离的文件，同时共享相同的 Git 历史和 reflog。

使用 git worktrees 使您能够同时在项目的不同部分运行多个 Claude 会话，每个会话都专注于其独立的任务。例如，您可能让一个 Claude 重构您的身份验证系统，而另一个则构建一个完全不相关的数据可视化组件。由于任务不重叠，每个 Claude 都可以全速工作，而无需等待对方的更改或处理合并冲突：

1.   创建 worktrees: `git worktree add ../project-feature-a feature-a`
2.   在每个 worktree 中启动 Claude: `cd ../project-feature-a && claude`
3.   根据需要创建额外的 worktrees（在新的终端选项卡中重复步骤1-2）。

一些提示：

*   使用一致的命名约定。
*   每个 worktree 维护一个终端选项卡。
*   如果您在 Mac 上使用 iTerm2，请设置当 Claude 需要注意时的通知。
*   为不同的 worktrees 使用不同的 IDE 窗口。
*   完成后清理：`git worktree remove ../project-feature-a`

#### d. 使用无头模式和自定义工具链

`claude -p`（无头模式）以编程方式将 Claude Code 集成到更大的工作流中，同时利用其内置工具和系统提示。使用无头模式主要有两种模式：

1.   **扇出（Fanning out）** 处理大规模迁移或分析（例如，分析数百个日志中的情绪或分析数千个 CSV）：

    *   让 Claude 编写一个脚本来生成任务列表。例如，生成一个需要从框架 A 迁移到框架 B 的 2000 个文件的列表。
    *   循环遍历任务，为每个任务以编程方式调用 Claude，并给它一个任务和一组它可以使用的工具。例如：`claude -p “将 foo.py 从 React 迁移到 Vue。完成后，如果成功，您必须返回字符串 OK，如果任务失败，则返回 FAIL。” --allowedTools Edit Bash(git commit:*)`
    *   多次运行脚本并优化您的提示以获得期望的结果。

2.   **管道化（Pipelining）** 将 Claude 集成到现有的数据/处理管道中：

    *   调用 `claude -p “<您的提示>” --json | your_command`，其中 `your_command` 是您处理管道的下一步。
    *   就是这样！JSON 输出（可选）可以帮助提供结构，以便于自动化处理。

对于这两种用例，使用 `--verbose` 标志进行调试 Claude 调用可能会有所帮助。我们通常建议在生产中关闭详细模式以获得更清晰的输出。

您在使用 Claude Code 方面有什么技巧和最佳实践？请标记 @AnthropicAI，让我们看看您正在构建什么！

**致谢**

由 Boris Cherny 撰写。这项工作借鉴了更广泛的 Claude Code 用户社区的最佳实践，他们富有创意的方法和工作流继续激励着我们。特别感谢 Daisy Hollman、Ashwin Bhat、Cat Wu、Sid Bidasaria、Cal Rueb、Nodir Turakulov、Barry Zhang、Drew Hodun 以及许多其他 Anthropic 工程师，他们对 Claude Code 的宝贵见解和实践经验帮助塑造了这些建议。

原文
--

*   [https://www.anthropic.com/engineering/claude-code-best-practices](https://www.anthropic.com/engineering/claude-code-best-practices)

